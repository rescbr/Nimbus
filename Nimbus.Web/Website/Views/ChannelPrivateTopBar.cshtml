@model Nimbus.Web.Website.Models.ChannelModel

<script type="text/javascript">
    //global
    currentDiv = 'divNotifications';
    divTipoTopic = '';
    CurrentQuestion = '1';
</script>

@*
  Atualizações
  Mas vistos
  Todos
  Novo Tópico
  Mensagens
*@
@Scripts.Render("~/Scripts/jquery.form.js")

<div class="wrapperChannel">
    <nav class="chanTopBar">
        <ul class="sbs">
            <li class="press"><a name="divNotifications" onclick="EnableDiv(this.name, 'currentDiv');">Atualizações</a></li>
            <li class="press"><a name="divPopularTopics" onclick="EnableDiv(this.name, 'currentDiv');">Mais vistos</a></li>
            <li class="press"><a name="divAllTopics" onclick="EnableDiv(this.name, 'currentDiv');">Todos</a></li>
            <li class="press"><a name="divNewTopic" onclick="EnableDiv(this.name, 'currentDiv');">Novo tópico</a></li>
            <li class="press"><a name="divMessages" onclick="EnableDiv(this.name, 'currentDiv');">Mensagens</a></li>
        </ul>
    </nav>

    <div>
        <div id="divNotifications">
        @*ultimos topicos + ultimos comentarios*@
        @*TODO:colocar script p 'ver mais' index de pagina*@
        @foreach (var item in Model.AllTopics.Take(15).OrderByDescending(m => m.LastModified))
        {
           @*Imagem e texto*@
                <div class="divTopic-grade">
                    <a href="/topic/@item.Id">
                        <div class="headerTopic-grade">
                            <h1>@item.Title</h1>
                            <img src="@item.ImgUrl" alt="@item.TopicType.ToString()" title="@item.Title" width="180" height="100">
                        </div>
                    </a>
                    <p class="contentTopic-grade">
                        @item.Description
                    </p>
                    <div class="footerTopic-grade">
                        <div class="btnLeftTopic-grade">
                            <p onclick="unReadLater();">Ler mais tarde</p> @*chamar js passando item.id*@
                        </div>
                        <div class="btnRightTopic-grade">
                            <p>s2</p> @*adicionar aos favoritos*@
                        </div>
                    </div>
                </div>
        }

        @if (Model.Comments.Count > 0)
        {
                <div id="divComments">
                    <p>Novos Comentários</p>
                    @foreach (var item in Model.Comments.Take(10).OrderByDescending(c => c.PostedOn))
                    { 
                        <div id="divComment_@item.Id" style="display:block">
                            <div id="divInfoComment" name="divInfoComment">
                                <input type="hidden" value="@item.Id" />
                                <img id="user+@item.UserId" src="@item.AvatarUrl" />
                                @item.UserName
                                @item.TopicName
                                @item.PostedOn
                                @item.Text
                                <button id="btnAnswerChComment" onclick="EnableDivHiddenBtn('divAnswer_@item.Id', 'btnAnswerChComment');">Responder</button>
                            </div>
                            <div id="divAnswer_@item.Id" name="divAnswer+@item.Id" style="display:none">
                               <textarea rows="10" cols="30" id="txtaAnswer" name="txtaAnswer" maxlength="500"></textarea>
                                <button id="btnAnswerComment" onclick="ajaxAnswerComment(@item.ParentId, @item.Id, @item.ChannelId, @item.TopicId, 'txtaAnswer');">Enviar</button>                                
                            </div>
                        </div>
                    }
              </div>
        }
        </div>

        <div id="divPopularTopics" style="display:none;">
            @foreach (var item in Model.AllTopics.OrderByDescending(m => m.Count))
            {
                @*Imagem e texto*@
                <div class="divTopic-grade">
                    <a href="/topic/@item.Id">
                        <div class="headerTopic-grade">
                            <h1>@item.Title</h1>
                            <img src="@item.ImgUrl" alt="@item.TopicType.ToString()" title="@item.Title" width="180" height="100">
                        </div>
                    </a>
                    <p class="contentTopic-grade">
                        @item.Description
                    </p>
                    <div class="footerTopic-grade">
                        <div class="btnLeftTopic-grade">
                            <p onclick="unReadLater();">Ler mais tarde</p> @*chamar js passando item.id*@
                        </div>
                        <div class="btnRightTopic-grade">
                            <p>s2</p> @*adicionar aos favoritos*@
                        </div>
                    </div>
                </div>
            }

        </div>

        <div id="divAllTopics" style="display:none;">
            @foreach (var item in Model.AllTopics.OrderByDescending(m => m.LastModified))
            {
                @*Imagem e texto*@
                <div class="divTopic-grade">
                    <a href="/topic/@item.Id">
                        <div class="headerTopic-grade">
                            <h1>@item.Title</h1>
                            <img src="@item.ImgUrl" alt="@item.TopicType.ToString()" title="@item.Title" width="180" height="100">
                        </div>
                    </a>
                    <p class="contentTopic-grade">
                        @item.Description
                    </p>
                    <div class="footerTopic-grade">
                        <div class="btnLeftTopic-grade">
                            <p onclick="unReadLater();">Ler mais tarde</p> @*chamar js passando item.id*@
                        </div>
                        <div class="btnRightTopic-grade">
                            <p>s2</p> @*adicionar aos favoritos*@
                        </div>
                    </div>
                </div>
            }
        </div>

        <div id="divNewTopic" style="display:none;">
            <p>
                Nome do tópico:
                <input type="text" id="txtNameTopic" maxlength="50" min="5" required name="txtNameTopic" />
            </p>
            <p>
                Imagem ilustrativa:
                <div id="divImgTopico" style="display:none;">
                    <img id="imgPrevia" src="" height="100" width="150" />
                </div>
            </p>
                <form action='/channel/upload' method="post" enctype="multipart/form-data" name="imagem_original">
                    <input type="file" name="imgTopic" id="imgTopic" />
                    <input type="submit" value="Carregar" class="hidden" style="display:none" id="upload" />
                    <input type="hidden" id="url" name="url" />
                    <label>Imagem de no máx. 5MB</label>
                </form>
        
            <p>
                Resumo:<br />
                <textarea cols="30" rows="5" id="txtaDescription" maxlength="150" required name="txtaDescription"></textarea>
            </p>

        
                <p>Tipo:</p>
                <div>
                    <label id="lblVideo" onclick="EnableTwoDiv('divVideo', 'divTipoTopic', 'divTypeTopic');">Vídeo</label>
                    <label id="lblText" onclick="EnableTwoDiv('divText', 'divTipoTopic', 'divTypeTopic');">Artigo</label>
                    <label id="lblDiscussion" onclick="EnableTwoDiv('divDiscussion', 'divTipoTopic', 'divTypeTopic');">Discussão</label>
                    <label id="lblExam" onclick="EnableTwoDiv('divExam', 'divTipoTopic', 'divTypeTopic');">Avaliação</label>
                </div>
       
            <div id="divTypeTopic" style="display:none;">
                <div id="divVideo" style="display:none;">
                    <input type="text" id="iptnamevideo" name="iptnamevideo" value="URL do vídeo" onfocus="javascript: this.value = ''" onchange="getUrlVideo(this.name, 'iframeVideo');" />
                    <label>Somente url do youtube</label><br />
                    <div id="divFrameVideo" style="display:none">
                        <iframe id="iframeVideo" width="420" height="345" name="iframeVideo"></iframe>
                    </div>
                </div>

                <div id="divText" style="display:none;">
                    <textarea id="txtaArticle" required class="ckeditor"></textarea>
                </div>

                <div id="divDiscussion" style="display:none;">
                    <p>
                        Questão em debate:
                        <textarea id="txtaTextMsg" required class="ckeditor"></textarea>
                    </p>
                </div>

            <div id="divExam" style="display:none;">               
                    <div id="divPergunta1">
                        <p>Enunciado da questão:
                    <input id="QuestionPerg1" name="enunciado" type="text" maxlength="600" />
                        </p>
                        <p>Respostas:</p>
                         <div>
                             <ul id="ulPerg1">
                                <li id="liPerg1_opt1"> @*pergunta 1 _ opçao 1*@
                                <input type="radio" name="radio" id="rdbPerg1_opt1" />
                                <input id="txtPerg1_opt1" name="resposta" type="text" onfocus="javascript: this.value = ''" value="Opção 1" />
                                </li>
                                <li id="liPerg1_opt2" onclick="DisableOption('2', 'divPergunta1');">
                                <input type="radio" name="radio" id="rdbPerg1_opt2" disabled="disabled" />
                                <input id="txtPerg1_opt2" name="resposta" type="text" disabled="disabled" onfocus="javascript: this.value = ''" value="Opção 2" />
                                 </li>
                             </ul> 
                        </div>
                    </div>
                </div>
                <button id="bntAddItem" onclick="CreatedDivQuestion();">Add item</button>
                    <br />
                    <button id="btnSalvar" onclick="SaveNewTopic(@Model.CurrentChannel.Id, false);">Salvar tópico</button>
            </div>
        </div>

        <div id="divMessages" style="display:none;">
            @if (Model.RolesCurrentUser.Contains("messagemanager"))
            {
                if(Model.Messages != null)
                { 
                    foreach (var item in Model.Messages)
                    {
                            <div class="post_m">
                                <div class="postHeImg_m">
                                    <img src=@item.AvatarUrl alt="blabla" title="blabla">
                                </div>
                                <div class="post_Right_m">
                                    <nav class="postHeaderLeft_m">
                                        <ul class="sbs">
                                            <li>@item.UserName/li>
                                                <li>@item.Title</li>
                                                </ul>
                                            </nav>
                                            <nav class="postHeaderRight_m">
                                                <ul class="sbs">
                                                    <li>@string.Format("{0:d/M/yyyy}", item.Date)</li>
                                                        <li>@string.Format("{0:HH:mm}", item.Date)</li>
                                                        </ul>
                                                    </nav>
                                                    <div class="postContent_m">
                                                        <p>@item.Text </p>
                                                        </div>
                                                    </div>
                                                </div>
                    }
                }
            }
        </div>
    </div>
</div>

<script type="text/javascript">
    var jcrop;

    $(document).ready(function () {

        $(document).on('change', 'input[name=imgTopic]', function () {
            $("#upload").click();
        });

        $('form[name=imagem_original]').ajaxForm({
            dataType: 'json',
            success: function (data) {
                $('input[name=url]').val(data.url);
                $("#imgPrevia").attr("src", data.url);
                $("#divImgTopico").attr("style", "display:block");
            }
        });
    });

</script>