@model Nimbus.Web.Website.Models.TopicModel
@{
    ViewBag.Title = "Topico";
    Layout = "~/Website/Views/Shared/_Layout.cshtml";
}

@Scripts.Render("~/Scripts/ScriptsShared.js")
@Scripts.Render("~/Scripts/ViewChannelScripts.js")
@Scripts.Render("~/Scripts/ViewTopicScripts.js")

<div id="divCapa">
    <img src="@Model.Category.ImgTopChannel"  id="imgcapa"  height="192" alt="" width="864" />
</div>


<div id="divInfTopic" style="margin: -30px 20px 0px 20px; float:left; width: 200px;">

    <div style="width: 150px; margin: 0 auto;">
        <img src="@Model.CurrentTopic.ImgUrl " id="imgTopic" height="100" alt=""  width="150" />
    </div>

    <h1 style="text-align: center; margin-top:5px;">
        @Model.CurrentTopic.Title - @Model.CurrentChannel.Name
    </h1>
    <p>@Model.CurrentTopic.Description</p>
    <button id="btnEditTopic" onclick="EditTopic();">Editar</button>

    <h1 style="margin: 20px 10px 20px 10px;">
        <img src="/images/favorite_topic_icon.png" style="margin: 0px 0px -5px 10px;"/>
        @Model.NumFavorites
    </h1>

    <p style="text-align: center; border: solid;">
        @*Categoria*@
        @Model.Category.Name
    </p>

    <div id="divCanaisRelacionados">
        @*TODO*@
    </div>
</div>


<div id="divContentTopic" style="float:right; width: 600px;">

    @*Topico em formato texto*@
    @if (Model.CurrentTopic.TopicType == Nimbus.Model.Enums.TopicType.exam)
    {
        @RenderPage("~/Website/Views/TopicAvalicao.cshtml")
    }
    else if (Model.CurrentTopic.TopicType == Nimbus.Model.Enums.TopicType.video)
        {
            @*Topico em formato de video*@
            @RenderPage("~/Website/Views/TopicVideo.cshtml")
        }
        else
        {
            @*Topico avaliacao*@
            @RenderPage("~/Website/Views/TopicText.cshtml")
        }
    


</div>

@if(Model.CurrentChannel.OpenToComments == true)
{   
    <div id="divCommentsTopic">
    <div id="divAllComments" style="float:right">
        <br />
        <h2>Comentários</h2>

        @if (Model.Comments.Count > 0)
        {
            foreach (var comment in Model.Comments)
            {
               <br />
                   if(comment.IsParent == true)
                    { 
                        <div id="divContentComment_@comment.Id" style="background-color:chocolate;">
                        <div id="divCommentParent_@comment.Id" style="display:block; float:none">
                            <div style="float:left">
                              <img src="@comment.AvatarUrl" id="imgTopic_@comment.Id" height="48" alt="" width="48" />
                            </div>
                            <div>
                                <p>
                                    @comment.UserName
                                    @comment.PostedOn
                                    @if (Model.CurrentUser.UserId == Model.CurrentChannel.OwnerId ||
                                        comment.UserId == Model.CurrentUser.UserId || Model.RolesCurrentUser.Contains("channelmanager")
                                                                                   || Model.RolesCurrentUser.Contains("topicmanager"))
                                        {
                                            <a href="#" title="Deletar" onclick="ajaxDeleteComment(@comment.Id, 'divCommentParent_@comment.Id');">X</a>
                                        }
                                </p>
                            </div>
                                 <div style="float:left">
                                <p>@comment.Text</p>
                             </div>
                        </div>
                        
                        @foreach (var child in comment.CommentChild)
                        {
                            <br />
                           <div id="divCommentChild_@child.Id" style="display:block; float:none">
                                <div style="float:left">
                                    <img src="@child.AvatarUrl" id="imgTopic_@child.Id" height="48" alt="" width="48" />
                                </div>
                                <div>
                                   <p>
                                       <label id="lblUserName_@child.Id">@child.UserName</label> 
                                      <label id="lblPostedOn_@child.Id">@child.PostedOn</label> 
                                       @if (child.Text != "Comentário removido" &&( Model.CurrentUser.UserId == Model.CurrentChannel.OwnerId ||
                                            comment.UserId == Model.CurrentUser.UserId || Model.RolesCurrentUser.Contains("channelmanager")
                                                                                       || Model.RolesCurrentUser.Contains("topicmanager")))
                                       {
                                         <a href="#" id="btnDelete_@child.Id" title="Deletar" onclick="ajaxDeleteComment(@child.Id,'divCommentChild_@child.Id' );">X</a>
                                       }
                                   </p>
                                 </div>
                                <div style="float:left">
                                    <p><label id="lblText_@child.Id">@child.Text</label></p>
                                </div>
                          </div>
                        }
                            <br />
                         <div id="divAnswerTopic_@comment.Id" style="display:block">                        
                            <button id="bntAnswer_@comment.Id" onclick="EnableDivHiddenBtn('divComment_@comment.Id', 'bntAnswer_@comment.Id');" value="Responder">Responder</button>
                         </div>
            
                         <div id="divComment_@comment.Id" style="display:none">
                                        <textarea id="txtaAnswer_@comment.Id" name="txtaAnswerTopic" cols="30" rows="2"></textarea>
                                        <button id="btnSendAnswer" onclick="ajaxAnswerComment(0,@comment.Id, @comment.ChannelId, @comment.TopicId, 'txtaAnswer_@comment.Id');" value="Enviar">Enviar</button>
                                    </div>
                     </div>
                    }                  
            }
        }
        else
        {
            <strong>Seja o primeiro a comentar!</strong>
        }
    </div>

    <div style="float:right">
        <br /><br />
        <h2 style="margin-bottom:5px;">Comentar</h2>
        <textarea id="txtacomentario" cols="50" rows="5"></textarea>
        <button id="btnNewComment" onclick="ajaxSaveNewComment(@Model.CurrentTopic.Id, @Model.CurrentTopic.ChannelId,'txtacomentario');" value="Enviar">Enviar</button>
    </div>

</div>
}








