@model Nimbus.Web.Website.Models.ChannelModel
@{
    ViewBag.Title = "Canal";
    Layout = "~/Website/Views/Shared/_Layout.cshtml";
}

@Scripts.Render(("~/Scripts/jquery.form.js"))

<div id="divCapa">
    <img src="@Model.CurrentChannel.ImgUrl" id="imgCapa" height="192" alt="" width="864" />
    @if (Model.CurrentChannel.OwnerId != Model.CurrentUser.UserId)
    {
        <div class="accRef">
            <p>Seguir</p>
        </div>
    }
</div>

@Scripts.Render("~/Scripts/ViewChannelScripts.js")

<div id="divInfCanal">
    <p>@Model.CurrentChannel.Name</p>
    <p>Dono: @Model.CurrentChannel.OwnerName</p>
    <p>Moderadores:</p>

    @foreach (var item in Model.Moderators)
    {
        <p>
            <a href="/userprofile/index/@item.Id"> @item.FirstName + @item.LastName</a>
        </p>
    }


    <p>
        @*colocar icone de total de seguidores*@
        @Model.CurrentChannel.countFollowers
    </p>
    <p>
        @*colocar icone pontuaçao*@
        @Model.CurrentChannel.CountVotes
    </p>

    @if (Model.CurrentChannel.OwnerId != Model.CurrentUser.UserId)
    {
        <div class="sendMessage">
            <p><a href="#modal-text" class="call-modal">Enviar Mensagem</a></p> <!-- clicavel -->
        </div>
    }

    @Model.CurrentChannel.participationChannel

    <p>
        @foreach (var item in Model.Tags)
        {
        <label>#@item.TagName</label>
        }
    </p>

    @if (Model.RolesCurrentUser.Contains("channelmanager")
         || Model.CurrentChannel.OwnerId == Model.CurrentUser.UserId)
    {
        <div class="press accRef">
            <p>Editar Tags</p>
        </div>
    }

    <div id="divCanaisRelacionados">
        @*TODO*@
    </div>
</div>

<div style="float:right;">
    @if (Model.CurrentChannel.OwnerId == Model.CurrentUser.UserId || Model.RolesCurrentUser.Contains("channelmanager") || Model.RolesCurrentUser.Contains("topicmanager")
        || Model.RolesCurrentUser.Contains("usermanager") || Model.RolesCurrentUser.Contains("messagemanager"))
    {
        @RenderPage("~/Website/Views/ChannelPrivateTopBar.cshtml")
    }
    else
    {
        @RenderPage("~/Website/Views/ChannelPublicTopBar.cshtml")
    }
</div>

<section class="semantic-content" id="modal-text" tabindex="-1" role="dialog" aria-labelledby="modal-label" aria-hidden="true">
    <div class="modal-inner">
        <header id="modal-label">
            <!-- Header -->
            Mensagem
        </header>

        @if (Model.CurrentChannel.OwnerId != Model.CurrentUser.UserId)
        {
            <form action="/channel/SendMessage/@Model.CurrentChannel.Id" method="post" enctype="multipart/form-data" id="sendMessage" name="sendMessage">
            <div class="modal-content">
                
                    <!-- The modals content -->
                    <p>
                        Para:
                        <input type="text" name="txtOwnerName" value="@Model.CurrentChannel.OwnerName" disabled="disabled" />
                    </p>
                    <p>
                        Cc:
                        <textarea name="txtaCc" disabled="disabled" cols="40" rows="5">
                            @if (Model.Moderators.Count > 0)
                            {
                                foreach (var item in Model.Moderators)
                                {
                                    @item.FirstName @item.LastName
                                }
                            }
                            else
                            {
                                <text>Apenas o dono do canal poderá receber está mensagem.</text>
                            }
                        </textarea>
                    </p>
                    <p>
                        Assunto:
                        <input name="txtTitleMsg" type="text" maxlength="100" />
                    </p><br />
                    <p>
                        <textarea id="txtTextMsg" name="txtTextMsg" rows="10" cols="60" class="ckeditor"></textarea>
                    </p>
                    
                
            </div>

            <footer>
                <!-- Footer -->
                <input type="submit" value="Enviar" id="btnEnviar" />
            </footer>
            </form>
        }


    </div>

    <a href="#!" id="closeModal" class="modal-close" title="Close this modal" data-close="Close"
       data-dismiss="modal">×</a>
</section>

@*Sempre manter no fim da página*@
<script type="text/javascript">
    CKEDITOR.replace('txtTextMsg', {
        toolbar: [
            { name: 'document', items: ['Source', '-', 'NewPage', 'Preview', '-', 'Templates'] },	// Defines toolbar group with name (used to create voice label) and items in 3 subgroups.
            ['Cut', 'Copy', 'Paste', 'PasteText', 'PasteFromWord', '-', 'Undo', 'Redo'],			// Defines toolbar group without name.
            '/',																					// Line break - next group will be placed in new line.
            { name: 'basicstyles', items: ['Bold', 'Italic'] }
        ]
    });

$(document).ready(function () {
 $('form[name=sendMessage]').ajaxForm({
            dataType: 'json',
            success: function (returnvalue) {
                 if(returnvalue.isok == false)
                 {
                    window.alert(returnvalue.message);
                 }
                 else
                     {
                     window.alert(returnvalue.message);
                     document.getElementById('closeModal').click();
                     }
            }
        });

     });
</script>

